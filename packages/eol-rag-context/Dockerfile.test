# Optimized test image for eol-rag-context integration tests
FROM python:3.11-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
    redis-tools \
    git \
    gcc \
    g++ \
    && rm -rf /var/lib/apt/lists/*

# Install Python dependencies upfront
RUN pip install --no-cache-dir \
    uv \
    pytest \
    pytest-asyncio \
    pytest-cov \
    pytest-timeout \
    pytest-xdist \
    redis \
    redisvl \
    sentence-transformers \
    aioredis \
    watchdog \
    gitignore-parser \
    tomli \
    typer \
    rich \
    fastmcp \
    numpy \
    pydantic

# Pre-download sentence transformer model
RUN python -c "from sentence_transformers import SentenceTransformer; SentenceTransformer('all-MiniLM-L6-v2')"

WORKDIR /app
